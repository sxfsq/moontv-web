(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[797],{51495:function(e,t,r){Promise.resolve().then(r.bind(r,38244))},38244:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return x}});var a=r(85787),o=r(57621),s=r(56770);let n=(0,r(54618).Z)("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);var l=r(8838),i=r(36429),c=r(56182),d=r(77914),u=r(59546);let h=["伦理片","福利","里番动漫","门事件","萝莉少女","制服诱惑","国产传媒","cosplay","黑丝诱惑","无码","日本无码","有码","日本有码","SWAG","网红主播","色情片","同性片","福利视频","福利片","写真热舞"];var g=r(93326),m=r(78070);function p(){let[e,t]=(0,i.useState)([]),[r,p]=(0,i.useState)(!1),x=(0,l.useRouter)(),v=(0,l.useSearchParams)(),[y,f]=(0,i.useState)(""),[b,w]=(0,i.useState)(!1),[k,j]=(0,i.useState)(!1),[N,C]=(0,i.useState)([]),S=()=>{{let e=localStorage.getItem("defaultAggregateSearch");if(null!==e)return JSON.parse(e)}return!0},[_,E]=(0,i.useState)(()=>S()?"agg":"all"),P=(0,i.useMemo)(()=>{let e=new Map;return N.forEach(t=>{let r="".concat(t.title.replaceAll(" ",""),"-").concat(t.year||"unknown","-").concat(1===t.episodes.length?"movie":"tv"),a=e.get(r)||[];a.push(t),e.set(r,a)}),Array.from(e.entries()).sort((e,t)=>{let r=e[1][0].title.replaceAll(" ","").includes(y.trim().replaceAll(" ","")),a=t[1][0].title.replaceAll(" ","").includes(y.trim().replaceAll(" ",""));if(r&&!a)return -1;if(!r&&a)return 1;if(e[1][0].year===t[1][0].year)return e[0].localeCompare(t[0]);{let r=e[1][0].year,a=t[1][0].year;return"unknown"===r&&"unknown"===a?0:"unknown"===r?1:"unknown"===a?-1:r>a?-1:1}})},[N]);(0,i.useEffect)(()=>{var e;v.get("q")||null===(e=document.getElementById("searchInput"))||void 0===e||e.focus(),(0,c.nO)().then(t);let r=(0,c.rq)("searchHistoryUpdated",e=>{t(e)}),a=()=>document.body.scrollTop||0,o=!1,s=()=>{o&&(p(a()>300),requestAnimationFrame(s))};o=!0,s();let n=()=>{p(a()>300)};return document.body.addEventListener("scroll",n,{passive:!0}),()=>{r(),o=!1,document.body.removeEventListener("scroll",n)}},[]),(0,i.useEffect)(()=>{let e=v.get("q");e?(f(e),I(e),(0,c.F0)(e)):j(!1)},[v]);let I=async e=>{try{var t;w(!0);let r=(await (0,d.ll)()).map(t=>(0,u.s)(t,e.trim()).catch(()=>[])),a=(await Promise.all(r)).flat();(null===(t=window.RUNTIME_CONFIG)||void 0===t?void 0:t.DISABLE_YELLOW_FILTER)||(a=a.filter(e=>{let t=e.type_name||"";return!h.some(e=>t.includes(e))})),C(a.sort((t,r)=>{let a=t.title===e.trim(),o=r.title===e.trim();return a&&!o?-1:!a&&o?1:t.year===r.year?t.title.localeCompare(r.title):"unknown"===t.year&&"unknown"===r.year?0:"unknown"===t.year?1:"unknown"===r.year?-1:parseInt(t.year)>parseInt(r.year)?-1:1})),j(!0)}catch(e){C([])}finally{w(!1)}};return(0,a.jsxs)(g.Z,{activePath:"/search",children:[(0,a.jsxs)("div",{className:"px-4 sm:px-10 py-4 sm:py-8 overflow-visible mb-10",children:[(0,a.jsx)("div",{className:"mb-8",children:(0,a.jsx)("form",{onSubmit:e=>{e.preventDefault();let t=y.trim().replace(/\s+/g," ");t&&(f(t),w(!0),j(!0),x.push("/search?q=".concat(encodeURIComponent(t))),I(t),(0,c.F0)(t))},className:"max-w-2xl mx-auto",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(o.Z,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 text-gray-400 dark:text-gray-500"}),(0,a.jsx)("input",{id:"searchInput",type:"text",value:y,onChange:e=>f(e.target.value),placeholder:"搜索电影、电视剧...",className:"w-full h-12 rounded-lg bg-gray-50/80 py-3 pl-10 pr-4 text-sm text-gray-700 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-400 focus:bg-white border border-gray-200/50 shadow-sm dark:bg-gray-800 dark:text-gray-300 dark:placeholder-gray-500 dark:focus:bg-gray-700 dark:border-gray-700"})]})})}),(0,a.jsx)("div",{className:"max-w-[95%] mx-auto mt-12 overflow-visible",children:b?(0,a.jsx)("div",{className:"flex justify-center items-center h-40",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"})}):k?(0,a.jsxs)("section",{className:"mb-12",children:[(0,a.jsxs)("div",{className:"mb-8 flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-200",children:"搜索结果"}),(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[(0,a.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"聚合"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:"agg"===_,onChange:()=>E("agg"===_?"all":"agg")}),(0,a.jsx)("div",{className:"w-9 h-5 bg-gray-300 rounded-full peer-checked:bg-green-500 transition-colors dark:bg-gray-600"}),(0,a.jsx)("div",{className:"absolute top-0.5 left-0.5 w-4 h-4 bg-white rounded-full transition-transform peer-checked:translate-x-4"})]})]})]}),(0,a.jsxs)("div",{className:"justify-start grid grid-cols-3 gap-x-2 gap-y-14 sm:gap-y-20 px-0 sm:px-2 sm:grid-cols-[repeat(auto-fill,_minmax(11rem,_1fr))] sm:gap-x-8",children:["agg"===_?P.map(e=>{let[t,r]=e;return(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)(m.Z,{from:"search",items:r,query:y.trim()!==r[0].title?y.trim():""})},"agg-".concat(t))}):N.map(e=>{var t;return(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)(m.Z,{id:e.id,title:e.title+" "+e.type_name,poster:e.poster,episodes:e.episodes.length,source:e.source,source_name:e.source_name,douban_id:null===(t=e.douban_id)||void 0===t?void 0:t.toString(),query:y.trim()!==e.title?y.trim():"",year:e.year,from:"search",type:e.episodes.length>1?"tv":"movie"})},"all-".concat(e.source,"-").concat(e.id))}),0===N.length&&(0,a.jsx)("div",{className:"col-span-full text-center text-gray-500 py-8 dark:text-gray-400",children:"未找到相关结果"})]},"search-results-".concat(_))]}):e.length>0?(0,a.jsxs)("section",{className:"mb-12",children:[(0,a.jsxs)("h2",{className:"mb-4 text-xl font-bold text-gray-800 text-left dark:text-gray-200",children:["搜索历史",e.length>0&&(0,a.jsx)("button",{onClick:()=>{(0,c.Ev)()},className:"ml-3 text-sm text-gray-500 hover:text-red-500 transition-colors dark:text-gray-400 dark:hover:text-red-500",children:"清空"})]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:e.map(e=>(0,a.jsxs)("div",{className:"relative group",children:[(0,a.jsx)("button",{onClick:()=>{f(e),x.push("/search?q=".concat(encodeURIComponent(e.trim())))},className:"px-4 py-2 bg-gray-500/10 hover:bg-gray-300 rounded-full text-sm text-gray-700 transition-colors duration-200 dark:bg-gray-700/50 dark:hover:bg-gray-600 dark:text-gray-300",children:e}),(0,a.jsx)("button",{"aria-label":"删除搜索历史",onClick:t=>{t.stopPropagation(),t.preventDefault(),(0,c.Rw)(e)},className:"absolute -top-1 -right-1 w-4 h-4 opacity-0 group-hover:opacity-100 bg-gray-400 hover:bg-red-500 text-white rounded-full flex items-center justify-center text-[10px] transition-colors",children:(0,a.jsx)(s.Z,{className:"w-3 h-3"})})]},e))})]}):null})]}),(0,a.jsx)("button",{onClick:()=>{try{document.body.scrollTo({top:0,behavior:"smooth"})}catch(e){document.body.scrollTop=0}},className:"fixed bottom-20 md:bottom-6 right-6 z-[500] w-12 h-12 bg-green-500/90 hover:bg-green-500 text-white rounded-full shadow-lg backdrop-blur-sm transition-all duration-300 ease-in-out flex items-center justify-center group ".concat(r?"opacity-100 translate-y-0 pointer-events-auto":"opacity-0 translate-y-4 pointer-events-none"),"aria-label":"返回顶部",children:(0,a.jsx)(n,{className:"w-6 h-6 transition-transform group-hover:scale-110"})})]})}function x(){return(0,a.jsx)(i.Suspense,{children:(0,a.jsx)(p,{})})}},92172:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});var a=r(85787);let o=e=>{let{aspectRatio:t}=e;return(0,a.jsx)("div",{className:"w-full ".concat(t," rounded-lg"),style:{background:"linear-gradient(90deg, var(--skeleton-color) 25%, var(--skeleton-highlight) 50%, var(--skeleton-color) 75%)",backgroundSize:"200% 100%",animation:"shine 1.5s infinite"},children:(0,a.jsx)("style",{children:"\n      @keyframes shine {\n        0% { background-position: -200% 0; }\n        100% { background-position: 200% 0; }\n      }\n      \n      /* 亮色模式变量 */\n      :root {\n        --skeleton-color: #f0f0f0;\n        --skeleton-highlight: #e0e0e0;\n      }\n      \n      /* 暗色模式变量 */\n      @media (prefers-color-scheme: dark) {\n        :root {\n          --skeleton-color: #2d2d2d;\n          --skeleton-highlight: #3d3d3d;\n        }\n      }\n      \n      .dark {\n        --skeleton-color: #2d2d2d;\n        --skeleton-highlight: #3d3d3d;\n      }\n    "})})}},78070:function(e,t,r){"use strict";r.d(t,{Z:function(){return m}});var a=r(85787),o=r(41647),s=r(90541),n=r(85639),l=r(87790),i=r(5304),c=r(8838),d=r(36429),u=r(56182),h=r(2551),g=r(92172);function m(e){var t,r,m,p,x,v,y,f;let{id:b,title:w="",query:k="",poster:j="",episodes:N,source:C,source_name:S,progress:_=0,year:E,from:P,currentEpisode:I,douban_id:R,onDelete:q,rate:D,items:Z,type:L=""}=e,A=(0,c.useRouter)(),[F,U]=(0,d.useState)(!1),[z,B]=(0,d.useState)(!1),H="search"===P&&!!(null==Z?void 0:Z.length),M=(0,d.useMemo)(()=>{if(!H||!Z)return null;let e=new Map,t=new Map;Z.forEach(r=>{var a;r.douban_id&&0!==r.douban_id&&e.set(r.douban_id,(e.get(r.douban_id)||0)+1);let o=(null===(a=r.episodes)||void 0===a?void 0:a.length)||0;o>0&&t.set(o,(t.get(o)||0)+1)});let r=e=>{let t,r=0;return e.forEach((e,a)=>{e>r&&(r=e,t=a)}),t};return{first:Z[0],mostFrequentDoubanId:r(e),mostFrequentEpisodes:r(t)||0}},[H,Z]),O=null!==(r=null==M?void 0:M.first.title)&&void 0!==r?r:w,T=null!==(m=null==M?void 0:M.first.poster)&&void 0!==m?m:j,W=null!==(p=null==M?void 0:M.first.source)&&void 0!==p?p:C,G=null!==(x=null==M?void 0:M.first.id)&&void 0!==x?x:b,J=String(null!==(v=null==M?void 0:M.mostFrequentDoubanId)&&void 0!==v?v:R),Y=null!==(y=null==M?void 0:M.mostFrequentEpisodes)&&void 0!==y?y:N,K=null!==(f=null==M?void 0:M.first.year)&&void 0!==f?f:E,Q=k||"",V=H?(null==M?void 0:null===(t=M.first.episodes)||void 0===t?void 0:t.length)===1?"movie":"tv":L;(0,d.useEffect)(()=>{if("douban"===P||!W||!G)return;(async()=>{try{let e=await (0,u.at)(W,G);U(e)}catch(e){throw Error("检查收藏状态失败")}})();let e=(0,u.sO)(W,G);return(0,u.rq)("favoritesUpdated",t=>{U(!!t[e])})},[P,W,G]);let X=(0,d.useCallback)(async e=>{if(e.preventDefault(),e.stopPropagation(),"douban"!==P&&W&&G)try{F?(await (0,u.r7)(W,G),U(!1)):(await (0,u.qn)(W,G,{title:O,source_name:S||"",year:K||"",cover:T,total_episodes:null!=Y?Y:1,save_time:Date.now()}),U(!0))}catch(e){throw Error("切换收藏状态失败")}},[P,W,G,O,S,K,T,Y,F]),$=(0,d.useCallback)(async e=>{if(e.preventDefault(),e.stopPropagation(),"playrecord"===P&&W&&G)try{await (0,u.Ji)(W,G),null==q||q()}catch(e){throw Error("删除播放记录失败")}},[P,W,G,q]),ee=(0,d.useCallback)(()=>{"douban"===P?A.push("/play?title=".concat(encodeURIComponent(O.trim())).concat(K?"&year=".concat(K):"").concat(V?"&stype=".concat(V):"")):W&&G&&A.push("/play?source=".concat(W,"&id=").concat(G,"&title=").concat(encodeURIComponent(O)).concat(K?"&year=".concat(K):"").concat(H?"&prefer=true":"").concat(Q?"&stitle=".concat(encodeURIComponent(Q.trim())):"").concat(V?"&stype=".concat(V):""))},[P,W,G,A,O,K,H,Q,V]),et=(0,d.useMemo)(()=>{let e={playrecord:{showSourceName:!0,showProgress:!0,showPlayButton:!0,showHeart:!0,showCheckCircle:!0,showDoubanLink:!1,showRating:!1},favorite:{showSourceName:!0,showProgress:!1,showPlayButton:!0,showHeart:!0,showCheckCircle:!1,showDoubanLink:!1,showRating:!1},search:{showSourceName:!0,showProgress:!1,showPlayButton:!0,showHeart:!H,showCheckCircle:!1,showDoubanLink:!!J,showRating:!1},douban:{showSourceName:!1,showProgress:!1,showPlayButton:!0,showHeart:!1,showCheckCircle:!1,showDoubanLink:!0,showRating:!!D}};return e[P]||e.search},[P,H,J,D]);return(0,a.jsxs)("div",{className:"group relative w-full rounded-lg bg-transparent cursor-pointer transition-all duration-300 ease-in-out hover:scale-[1.05] hover:z-[500]",onClick:ee,children:[(0,a.jsxs)("div",{className:"relative aspect-[2/3] overflow-hidden rounded-lg",children:[!z&&(0,a.jsx)(g.Z,{aspectRatio:"aspect-[2/3]"}),(0,a.jsx)(i.default,{src:(0,h.a8)(T),alt:O,fill:!0,className:"object-cover",referrerPolicy:"no-referrer",onLoadingComplete:()=>B(!0)}),(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent opacity-0 transition-opacity duration-300 ease-in-out group-hover:opacity-100"}),et.showPlayButton&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 transition-all duration-300 ease-in-out delay-75 group-hover:opacity-100 group-hover:scale-100",children:(0,a.jsx)(o.Z,{size:50,strokeWidth:.8,className:"text-white fill-transparent transition-all duration-300 ease-out hover:fill-green-500 hover:scale-[1.1]"})}),(et.showHeart||et.showCheckCircle)&&(0,a.jsxs)("div",{className:"absolute bottom-3 right-3 flex gap-3 opacity-0 translate-y-2 transition-all duration-300 ease-in-out group-hover:opacity-100 group-hover:translate-y-0",children:[et.showCheckCircle&&(0,a.jsx)(s.Z,{onClick:$,size:20,className:"text-white transition-all duration-300 ease-out hover:stroke-green-500 hover:scale-[1.1]"}),et.showHeart&&(0,a.jsx)(n.Z,{onClick:X,size:20,className:"transition-all duration-300 ease-out ".concat(F?"fill-red-600 stroke-red-600":"fill-transparent stroke-white hover:stroke-red-400"," hover:scale-[1.1]")})]}),et.showRating&&D&&(0,a.jsx)("div",{className:"absolute top-2 right-2 bg-pink-500 text-white text-xs font-bold w-7 h-7 rounded-full flex items-center justify-center shadow-md transition-all duration-300 ease-out group-hover:scale-110",children:D}),Y&&Y>1&&(0,a.jsx)("div",{className:"absolute top-2 right-2 bg-green-500 text-white text-xs font-semibold px-2 py-1 rounded-md shadow-md transition-all duration-300 ease-out group-hover:scale-110",children:I?"".concat(I,"/").concat(Y):Y}),et.showDoubanLink&&J&&(0,a.jsx)("a",{href:"https://movie.douban.com/subject/".concat(J),target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"absolute top-2 left-2 opacity-0 -translate-x-2 transition-all duration-300 ease-in-out delay-100 group-hover:opacity-100 group-hover:translate-x-0",children:(0,a.jsx)("div",{className:"bg-green-500 text-white text-xs font-bold w-7 h-7 rounded-full flex items-center justify-center shadow-md hover:bg-green-600 hover:scale-[1.1] transition-all duration-300 ease-out",children:(0,a.jsx)(l.Z,{size:16})})})]}),et.showProgress&&void 0!==_&&(0,a.jsx)("div",{className:"mt-1 h-1 w-full bg-gray-200 rounded-full overflow-hidden",children:(0,a.jsx)("div",{className:"h-full bg-green-500 transition-all duration-500 ease-out",style:{width:"".concat(_,"%")}})}),(0,a.jsxs)("div",{className:"mt-2 text-center",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("span",{className:"block text-sm font-semibold truncate text-gray-900 dark:text-gray-100 transition-colors duration-300 ease-in-out group-hover:text-green-600 dark:group-hover:text-green-400 peer",children:O}),(0,a.jsxs)("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-1 bg-gray-800 text-white text-xs rounded-md shadow-lg opacity-0 invisible peer-hover:opacity-100 peer-hover:visible transition-all duration-200 ease-out delay-100 whitespace-nowrap pointer-events-none",children:[O,(0,a.jsx)("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800"})]})]}),et.showSourceName&&S&&(0,a.jsx)("span",{className:"block text-xs text-gray-500 dark:text-gray-400 mt-1",children:(0,a.jsx)("span",{className:"inline-block border rounded px-2 py-0.5 border-gray-500/60 dark:border-gray-400/60 transition-all duration-300 ease-in-out group-hover:border-green-500/60 group-hover:text-green-600 dark:group-hover:text-green-400",children:S})})]})]})}}},function(e){e.O(0,[447,461,967,139,376,326,682,890,541,29,744],function(){return e(e.s=51495)}),_N_E=e.O()}]);