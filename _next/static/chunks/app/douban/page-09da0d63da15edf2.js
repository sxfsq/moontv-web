(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[936],{76151:function(e,t,l){Promise.resolve().then(l.bind(l,7249))},7249:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return f}});var a=l(85787),s=l(8838),r=l(36429),n=l(50429),i=l(92172),u=()=>(0,a.jsx)("div",{className:"w-full",children:(0,a.jsxs)("div",{className:"group relative w-full rounded-lg bg-transparent shadow-none flex flex-col",children:[(0,a.jsx)(i.Z,{aspectRatio:"aspect-[2/3]"}),(0,a.jsx)("div",{className:"absolute top-[calc(100%+0.5rem)] left-0 right-0",children:(0,a.jsx)("div",{className:"flex flex-col items-center justify-center",children:(0,a.jsx)("div",{className:"h-4 w-24 sm:w-32 bg-gray-200 rounded animate-pulse mb-2"})})})]})}),c=e=>{var t,l;let{customCategories:s,primarySelection:n,secondarySelection:i,onPrimaryChange:u,onSecondaryChange:c}=e,o=(0,r.useRef)(null),d=(0,r.useRef)([]),[m,x]=(0,r.useState)({left:0,width:0}),f=(0,r.useRef)(null),v=(0,r.useRef)([]),[h,p]=(0,r.useState)({left:0,width:0}),g=(0,r.useRef)(null),y=r.useMemo(()=>Array.from(new Set(s.map(e=>e.type))).sort((e,t)=>"movie"===e&&"movie"!==t?-1:"movie"!==e&&"movie"===t?1:0).map(e=>({label:"movie"===e?"电影":"剧集",value:e})),[s]),w=r.useMemo(()=>n?s.filter(e=>e.type===n).map(e=>({label:e.name||e.query,value:e.query})):[],[s,n]),b=r.useCallback(e=>{e.preventDefault(),e.stopPropagation();let t=g.current;if(t){let l=2*e.deltaY;t.scrollLeft+=l}},[]);(0,r.useEffect)(()=>{let e=g.current,t=f.current;if(e&&t)return e.addEventListener("wheel",b,{passive:!1}),t.addEventListener("wheel",b,{passive:!1}),()=>{e.removeEventListener("wheel",b),t.removeEventListener("wheel",b)}},[b]),(0,r.useEffect)(()=>{let e=g.current,t=f.current;if(e&&t&&w.length>0)return e.addEventListener("wheel",b,{passive:!1}),t.addEventListener("wheel",b,{passive:!1}),()=>{e.removeEventListener("wheel",b),t.removeEventListener("wheel",b)}},[b,w]);let j=(e,t,l,a)=>{if(e>=0&&l.current[e]&&t.current){let s=setTimeout(()=>{let s=l.current[e],r=t.current;if(s&&r){let e=s.getBoundingClientRect(),t=r.getBoundingClientRect();e.width>0&&a({left:e.left-t.left,width:e.width})}},0);return()=>clearTimeout(s)}};(0,r.useEffect)(()=>{y.length>0&&j(y.findIndex(e=>e.value===(n||y[0].value)),o,d,x),w.length>0&&j(w.findIndex(e=>e.value===(i||w[0].value)),f,v,p)},[y,w]),(0,r.useEffect)(()=>{if(y.length>0)return j(y.findIndex(e=>e.value===n),o,d,x)},[n,y]),(0,r.useEffect)(()=>{if(w.length>0)return j(w.findIndex(e=>e.value===i),f,v,p)},[i,w]);let N=function(e,t,l){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=s?d:v,n=s?m:h;return(0,a.jsxs)("div",{ref:s?o:f,className:"relative inline-flex bg-gray-200/60 rounded-full p-0.5 sm:p-1 dark:bg-gray-700/60 backdrop-blur-sm",children:[n.width>0&&(0,a.jsx)("div",{className:"absolute top-0.5 bottom-0.5 sm:top-1 sm:bottom-1 bg-white dark:bg-gray-500 rounded-full shadow-sm transition-all duration-300 ease-out",style:{left:"".concat(n.left,"px"),width:"".concat(n.width,"px")}}),e.map((e,s)=>{let n=t===e.value;return(0,a.jsx)("button",{ref:e=>{r.current[s]=e},onClick:()=>l(e.value),className:"relative z-10 px-2 py-1 sm:px-4 sm:py-2 text-xs sm:text-sm font-medium rounded-full transition-all duration-200 whitespace-nowrap ".concat(n?"text-gray-900 dark:text-gray-100 cursor-default":"text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100 cursor-pointer"),children:e.label},e.value)})]})};return s&&0!==s.length?(0,a.jsx)("div",{className:"space-y-4 sm:space-y-6",children:(0,a.jsxs)("div",{className:"space-y-3 sm:space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[(0,a.jsx)("span",{className:"text-xs sm:text-sm font-medium text-gray-600 dark:text-gray-400 min-w-[48px]",children:"类型"}),(0,a.jsx)("div",{className:"overflow-x-auto",children:N(y,n||(null===(t=y[0])||void 0===t?void 0:t.value),u,!0)})]}),w.length>0&&(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[(0,a.jsx)("span",{className:"text-xs sm:text-sm font-medium text-gray-600 dark:text-gray-400 min-w-[48px]",children:"片单"}),(0,a.jsx)("div",{ref:g,className:"overflow-x-auto",children:N(w,i||(null===(l=w[0])||void 0===l?void 0:l.value),c,!1)})]})]})}):null},o=e=>{let{type:t,primarySelection:l,secondarySelection:s,onPrimaryChange:n,onSecondaryChange:i}=e,u=(0,r.useRef)(null),c=(0,r.useRef)([]),[o,d]=(0,r.useState)({left:0,width:0}),m=(0,r.useRef)(null),x=(0,r.useRef)([]),[f,v]=(0,r.useState)({left:0,width:0}),h=[{label:"热门电影",value:"热门"},{label:"最新电影",value:"最新"},{label:"豆瓣高分",value:"豆瓣高分"},{label:"冷门佳片",value:"冷门佳片"}],p=[{label:"全部",value:"全部"},{label:"华语",value:"华语"},{label:"欧美",value:"欧美"},{label:"韩国",value:"韩国"},{label:"日本",value:"日本"}],g=[{label:"全部",value:"tv"},{label:"国产",value:"tv_domestic"},{label:"欧美",value:"tv_american"},{label:"日本",value:"tv_japanese"},{label:"韩国",value:"tv_korean"},{label:"动漫",value:"tv_animation"},{label:"纪录片",value:"tv_documentary"}],y=[{label:"全部",value:"show"},{label:"国内",value:"show_domestic"},{label:"国外",value:"show_foreign"}],w=(e,t,l,a)=>{if(e>=0&&l.current[e]&&t.current){let s=setTimeout(()=>{let s=l.current[e],r=t.current;if(s&&r){let e=s.getBoundingClientRect(),t=r.getBoundingClientRect();e.width>0&&a({left:e.left-t.left,width:e.width})}},0);return()=>clearTimeout(s)}};(0,r.useEffect)(()=>{"movie"===t&&w(h.findIndex(e=>e.value===(l||h[0].value)),u,c,d);let e=-1;"movie"===t?e=p.findIndex(e=>e.value===(s||p[0].value)):"tv"===t?e=g.findIndex(e=>e.value===(s||g[0].value)):"show"===t&&(e=y.findIndex(e=>e.value===(s||y[0].value))),e>=0&&w(e,m,x,v)},[t]),(0,r.useEffect)(()=>{if("movie"===t)return w(h.findIndex(e=>e.value===l),u,c,d)},[l]),(0,r.useEffect)(()=>{let e=-1,l=[];if("movie"===t?(e=p.findIndex(e=>e.value===s),l=p):"tv"===t?(e=g.findIndex(e=>e.value===s),l=g):"show"===t&&(e=y.findIndex(e=>e.value===s),l=y),l.length>0)return w(e,m,x,v)},[s]);let b=function(e,t,l){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=s?c:x,n=s?o:f;return(0,a.jsxs)("div",{ref:s?u:m,className:"relative inline-flex bg-gray-200/60 rounded-full p-0.5 sm:p-1 dark:bg-gray-700/60 backdrop-blur-sm",children:[n.width>0&&(0,a.jsx)("div",{className:"absolute top-0.5 bottom-0.5 sm:top-1 sm:bottom-1 bg-white dark:bg-gray-500 rounded-full shadow-sm transition-all duration-300 ease-out",style:{left:"".concat(n.left,"px"),width:"".concat(n.width,"px")}}),e.map((e,s)=>{let n=t===e.value;return(0,a.jsx)("button",{ref:e=>{r.current[s]=e},onClick:()=>l(e.value),className:"relative z-10 px-2 py-1 sm:px-4 sm:py-2 text-xs sm:text-sm font-medium rounded-full transition-all duration-200 whitespace-nowrap ".concat(n?"text-gray-900 dark:text-gray-100 cursor-default":"text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100 cursor-pointer"),children:e.label},e.value)})]})};return(0,a.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:["movie"===t&&(0,a.jsxs)("div",{className:"space-y-3 sm:space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[(0,a.jsx)("span",{className:"text-xs sm:text-sm font-medium text-gray-600 dark:text-gray-400 min-w-[48px]",children:"分类"}),(0,a.jsx)("div",{className:"overflow-x-auto",children:b(h,l||h[0].value,n,!0)})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[(0,a.jsx)("span",{className:"text-xs sm:text-sm font-medium text-gray-600 dark:text-gray-400 min-w-[48px]",children:"地区"}),(0,a.jsx)("div",{className:"overflow-x-auto",children:b(p,s||p[0].value,i,!1)})]})]}),"tv"===t&&(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[(0,a.jsx)("span",{className:"text-xs sm:text-sm font-medium text-gray-600 dark:text-gray-400 min-w-[48px]",children:"类型"}),(0,a.jsx)("div",{className:"overflow-x-auto",children:b(g,s||g[0].value,i,!1)})]}),"show"===t&&(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[(0,a.jsx)("span",{className:"text-xs sm:text-sm font-medium text-gray-600 dark:text-gray-400 min-w-[48px]",children:"类型"}),(0,a.jsx)("div",{className:"overflow-x-auto",children:b(y,s||y[0].value,i,!1)})]})]})},d=l(93326),m=l(78070);function x(){let e=(0,s.useSearchParams)(),[t,l]=(0,r.useState)([]),[i,x]=(0,r.useState)(!1),[f,v]=(0,r.useState)(0),[h,p]=(0,r.useState)(!0),[g,y]=(0,r.useState)(!1),[w,b]=(0,r.useState)(!1),j=(0,r.useRef)(null),N=(0,r.useRef)(null),k=(0,r.useRef)(null),E=e.get("type")||"movie",[S,C]=(0,r.useState)([]),[R,_]=(0,r.useState)(()=>"movie"===E?"热门":""),[I,T]=(0,r.useState)(()=>"movie"===E?"全部":"tv"===E?"tv":"show"===E?"show":"全部");(0,r.useEffect)(()=>{var e;let t=window.RUNTIME_CONFIG;(null==t?void 0:null===(e=t.CUSTOM_CATEGORIES)||void 0===e?void 0:e.length)>0&&C(t.CUSTOM_CATEGORIES)},[]),(0,r.useEffect)(()=>{let e=setTimeout(()=>{b(!0)},50);return()=>clearTimeout(e)},[]),(0,r.useEffect)(()=>{b(!1),x(!0)},[E]),(0,r.useEffect)(()=>{if("custom"===E&&S.length>0){let e=Array.from(new Set(S.map(e=>e.type)));if(e.length>0){let t=e[0];_(t=e.includes("movie")?"movie":"tv");let l=S.find(e=>e.type===t);l&&T(l.query)}}else"movie"===E?(_("热门"),T("全部")):"tv"===E?(_(""),T("tv")):"show"===E?(_(""),T("show")):(_(""),T("全部"));let e=setTimeout(()=>{b(!0)},50);return()=>clearTimeout(e)},[E,S]);let L=Array.from({length:25},(e,t)=>t),q=(0,r.useCallback)(e=>"tv"===E||"show"===E?{kind:"tv",category:E,type:I,pageLimit:25,pageStart:e}:{kind:E,category:R,type:I,pageLimit:25,pageStart:e},[E,R,I]),O=(0,r.useCallback)(async()=>{try{let e;if(x(!0),"custom"===E){let t=S.find(e=>e.type===R&&e.query===I);if(t)e=await (0,n.$E)({tag:t.query,type:t.type,pageLimit:25,pageStart:0});else throw Error("没有找到对应的分类")}else e=await (0,n.Z_)(q(0));if(200===e.code)l(e.list),p(25===e.list.length),x(!1);else throw Error(e.message||"获取数据失败")}catch(e){console.error(e)}},[E,R,I,q,S]);(0,r.useEffect)(()=>{if(w)return l([]),v(0),p(!0),y(!1),k.current&&clearTimeout(k.current),k.current=setTimeout(()=>{O()},100),()=>{k.current&&clearTimeout(k.current)}},[w,E,R,I,O]),(0,r.useEffect)(()=>{f>0&&(async()=>{try{let e;if(y(!0),"custom"===E){let t=S.find(e=>e.type===R&&e.query===I);if(t)e=await (0,n.$E)({tag:t.query,type:t.type,pageLimit:25,pageStart:25*f});else throw Error("没有找到对应的分类")}else e=await (0,n.Z_)(q(25*f));if(200===e.code)l(t=>[...t,...e.list]),p(25===e.list.length);else throw Error(e.message||"获取数据失败")}catch(e){console.error(e)}finally{y(!1)}})()},[f,E,R,I,S]),(0,r.useEffect)(()=>{if(!h||g||i||!N.current)return;let e=new IntersectionObserver(e=>{e[0].isIntersecting&&h&&!g&&v(e=>e+1)},{threshold:.1});return e.observe(N.current),j.current=e,()=>{j.current&&j.current.disconnect()}},[h,g,i]);let P=(0,r.useCallback)(e=>{if(e!==R){if(x(!0),"custom"===E&&S.length>0){let t=S.find(t=>t.type===e);t?(_(e),T(t.query)):_(e)}else _(e)}},[R,E,S]),A=(0,r.useCallback)(e=>{e!==I&&(x(!0),T(e))},[I]);return(0,a.jsx)(d.Z,{activePath:(()=>{let e=new URLSearchParams;E&&e.set("type",E);let t=e.toString();return"/douban".concat(t?"?".concat(t):"")})(),children:(0,a.jsxs)("div",{className:"px-4 sm:px-10 py-4 sm:py-8 overflow-visible",children:[(0,a.jsxs)("div",{className:"mb-6 sm:mb-8 space-y-4 sm:space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-800 mb-1 sm:mb-2 dark:text-gray-200",children:"movie"===E?"电影":"tv"===E?"电视剧":"show"===E?"综艺":"自定义"}),(0,a.jsx)("p",{className:"text-sm sm:text-base text-gray-600 dark:text-gray-400",children:"来自豆瓣的精选内容"})]}),"custom"!==E?(0,a.jsx)("div",{className:"bg-white/60 dark:bg-gray-800/40 rounded-2xl p-4 sm:p-6 border border-gray-200/30 dark:border-gray-700/30 backdrop-blur-sm",children:(0,a.jsx)(o,{type:E,primarySelection:R,secondarySelection:I,onPrimaryChange:P,onSecondaryChange:A})}):(0,a.jsx)("div",{className:"bg-white/60 dark:bg-gray-800/40 rounded-2xl p-4 sm:p-6 border border-gray-200/30 dark:border-gray-700/30 backdrop-blur-sm",children:(0,a.jsx)(c,{customCategories:S,primarySelection:R,secondarySelection:I,onPrimaryChange:P,onSecondaryChange:A})})]}),(0,a.jsxs)("div",{className:"max-w-[95%] mx-auto mt-8 overflow-visible",children:[(0,a.jsx)("div",{className:"justify-start grid grid-cols-3 gap-x-2 gap-y-12 px-0 sm:px-2 sm:grid-cols-[repeat(auto-fill,minmax(160px,1fr))] sm:gap-x-8 sm:gap-y-20",children:i||!w?L.map(e=>(0,a.jsx)(u,{},e)):t.map((e,t)=>(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)(m.Z,{from:"douban",title:e.title,poster:e.poster,douban_id:e.id,rate:e.rate,year:e.year,type:"movie"===E?"movie":""})},"".concat(e.title,"-").concat(t)))}),h&&!i&&(0,a.jsx)("div",{ref:e=>{e&&null!==e.offsetParent&&(N.current=e)},className:"flex justify-center mt-12 py-8",children:g&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-green-500"}),(0,a.jsx)("span",{className:"text-gray-600",children:"加载中..."})]})}),!h&&t.length>0&&(0,a.jsx)("div",{className:"text-center text-gray-500 py-8",children:"已加载全部内容"}),!i&&0===t.length&&(0,a.jsx)("div",{className:"text-center text-gray-500 py-8",children:"暂无相关内容"})]})]})})}function f(){return(0,a.jsx)(r.Suspense,{children:(0,a.jsx)(x,{})})}}},function(e){e.O(0,[447,967,139,326,682,459,541,29,744],function(){return e(e.s=76151)}),_N_E=e.O()}]);