(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{55764:function(e,t,r){Promise.resolve().then(r.bind(r,13773))},13773:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return y}});var n=r(85787),a=r(84125),l=r.n(a),s=r(82628),o=r(85639),i=r(8838),c=r(36429),u=r(56182),d=r(77914),m=r(59546),h=r(2551),f=e=>{let{totalEpisodes:t,episodesPerPage:r=50,value:a=1,onChange:l,onSourceChange:s,currentSource:o,currentId:u,videoTitle:d,availableSources:m=[],sourceSearchLoading:f=!1,sourceSearchError:g=null,precomputedVideoInfo:x}=e,p=(0,i.useRouter)(),v=Math.ceil(t/r),[y,b]=(0,c.useState)(new Map),[w,j]=(0,c.useState)(new Set),k=(0,c.useRef)(new Set),N=(0,c.useRef)(new Map);(0,c.useEffect)(()=>{k.current=w},[w]),(0,c.useEffect)(()=>{N.current=y},[y]);let[S,M]=(0,c.useState)(t>1?"episodes":"sources"),[D,E]=(0,c.useState)(Math.floor((a-1)/r)),[C,R]=(0,c.useState)(!1),_=(0,c.useMemo)(()=>C?v-1-D:D,[D,C,v]),L=(0,c.useCallback)(async e=>{let t="".concat(e.source,"-").concat(e.id);if(k.current.has(t)||!e.episodes||0===e.episodes.length)return;let r=e.episodes.length>1?e.episodes[1]:e.episodes[0];j(e=>new Set(e).add(t));try{let e=await (0,h.e9)(r);b(r=>new Map(r).set(t,e))}catch(e){b(e=>new Map(e).set(t,{quality:"错误",loadSpeed:"未知",pingTime:0,hasError:!0}))}},[]);(0,c.useEffect)(()=>{x&&x.size>0&&(b(e=>{let t=new Map(e);return x.forEach((e,r)=>{t.set(r,e)}),t}),j(e=>{let t=new Set(e);return x.forEach((e,r)=>{e.hasError||t.add(r)}),t}),x.forEach((e,t)=>{e.hasError||k.current.add(t)}))},[x]);let[T]=(0,c.useState)(()=>{{let e=localStorage.getItem("enableOptimization");if(null!==e)try{return JSON.parse(e)}catch(e){}}return!0});(0,c.useEffect)(()=>{(async()=>{if(!T||"sources"!==S||0===m.length)return;let e=m.filter(e=>{let t="".concat(e.source,"-").concat(e.id);return!k.current.has(t)});if(0===e.length)return;let t=Math.ceil(e.length/2);for(let r=0;r<e.length;r+=t){let n=e.slice(r,r+t);await Promise.all(n.map(L))}})()},[S,m,L,T]);let P=(0,c.useMemo)(()=>Array.from({length:v},(e,n)=>{let a=n*r+1,l=Math.min(a+r-1,t);return{start:a,end:l}}),[v,r,t]),I=(0,c.useMemo)(()=>C?[...P].reverse().map(e=>{let{start:t,end:r}=e;return"".concat(r,"-").concat(t)}):P.map(e=>{let{start:t,end:r}=e;return"".concat(t,"-").concat(r)}),[P,C]),A=(0,c.useRef)(null),B=(0,c.useRef)([]);(0,c.useEffect)(()=>{let e=B.current[_],t=A.current;if(e&&t){let r=t.getBoundingClientRect(),n=e.getBoundingClientRect(),a=t.scrollLeft,l=n.left-r.left+a,s=n.width,o=r.width;t.scrollTo({left:l-(o-s)/2,behavior:"smooth"})}},[_,v]);let Z=(0,c.useCallback)(e=>{C?E(v-1-e):E(e)},[C,v]),O=(0,c.useCallback)(e=>{null==l||l(e)},[l]),U=(0,c.useCallback)(e=>{null==s||s(e.source,e.id,e.title)},[s]),z=D*r+1,F=Math.min(z+r-1,t);return(0,n.jsxs)("div",{className:"md:ml-2 px-4 py-0 h-full rounded-xl bg-black/10 dark:bg-white/5 flex flex-col border border-white/0 dark:border-white/30 overflow-hidden",children:[(0,n.jsxs)("div",{className:"flex mb-1 -mx-6 flex-shrink-0",children:[t>1&&(0,n.jsx)("div",{onClick:()=>M("episodes"),className:"flex-1 py-3 px-6 text-center cursor-pointer transition-all duration-200 font-medium\n              ".concat("episodes"===S?"text-green-600 dark:text-green-400":"text-gray-700 hover:text-green-600 bg-black/5 dark:bg-white/5 dark:text-gray-300 dark:hover:text-green-400 hover:bg-black/3 dark:hover:bg-white/3","\n            ").trim(),children:"选集"}),(0,n.jsx)("div",{onClick:()=>{M("sources")},className:"flex-1 py-3 px-6 text-center cursor-pointer transition-all duration-200 font-medium\n            ".concat("sources"===S?"text-green-600 dark:text-green-400":"text-gray-700 hover:text-green-600 bg-black/5 dark:bg-white/5 dark:text-gray-300 dark:hover:text-green-400 hover:bg-black/3 dark:hover:bg-white/3","\n          ").trim(),children:"换源"})]}),"episodes"===S&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex items-center gap-4 mb-4 border-b border-gray-300 dark:border-gray-700 -mx-6 px-6 flex-shrink-0",children:[(0,n.jsx)("div",{className:"flex-1 overflow-x-auto",ref:A,children:(0,n.jsx)("div",{className:"flex gap-2 min-w-max",children:I.map((e,t)=>{let r=t===_;return(0,n.jsxs)("button",{ref:e=>{B.current[t]=e},onClick:()=>Z(t),className:"w-20 relative py-2 text-sm font-medium transition-colors whitespace-nowrap flex-shrink-0 text-center \n                        ".concat(r?"text-green-500 dark:text-green-400":"text-gray-700 hover:text-green-600 dark:text-gray-300 dark:hover:text-green-400","\n                      ").trim(),children:[e,r&&(0,n.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-green-500 dark:bg-green-400"})]},e)})})}),(0,n.jsx)("button",{className:"flex-shrink-0 w-8 h-8 rounded-md flex items-center justify-center text-gray-700 hover:text-green-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:text-green-400 dark:hover:bg-white/20 transition-colors transform translate-y-[-4px]",onClick:()=>{R(e=>!e)},children:(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})})})]}),(0,n.jsx)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(40px,1fr))] auto-rows-[40px] gap-x-3 gap-y-3 overflow-y-auto h-full pb-4",children:Array.from({length:F-z+1},(e,t)=>C?F-t:z+t).map(e=>{let t=e===a;return(0,n.jsx)("button",{onClick:()=>O(e-1),className:"h-10 flex items-center justify-center text-sm font-medium rounded-md transition-all duration-200 \n                    ".concat(t?"bg-green-500 text-white shadow-lg shadow-green-500/25 dark:bg-green-600":"bg-gray-200 text-gray-700 hover:bg-gray-300 hover:scale-105 dark:bg-white/10 dark:text-gray-300 dark:hover:bg-white/20").trim(),children:e},e)})})]}),"sources"===S&&(0,n.jsxs)("div",{className:"flex flex-col h-full mt-4",children:[f&&(0,n.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"}),(0,n.jsx)("span",{className:"ml-2 text-sm text-gray-600 dark:text-gray-300",children:"搜索中..."})]}),g&&(0,n.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-red-500 text-2xl mb-2",children:"⚠️"}),(0,n.jsx)("p",{className:"text-sm text-red-600 dark:text-red-400",children:g})]})}),!f&&!g&&0===m.length&&(0,n.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-gray-400 text-2xl mb-2",children:"\uD83D\uDCFA"}),(0,n.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"暂无可用的换源"})]})}),!f&&!g&&m.length>0&&(0,n.jsxs)("div",{className:"flex-1 overflow-y-auto space-y-2 pb-20",children:[m.sort((e,t)=>{var r,n,a,l;let s=(null===(r=e.source)||void 0===r?void 0:r.toString())===(null==o?void 0:o.toString())&&(null===(n=e.id)||void 0===n?void 0:n.toString())===(null==u?void 0:u.toString()),i=(null===(a=t.source)||void 0===a?void 0:a.toString())===(null==o?void 0:o.toString())&&(null===(l=t.id)||void 0===l?void 0:l.toString())===(null==u?void 0:u.toString());return s&&!i?-1:!s&&i?1:0}).map((e,t)=>{var r,a;let l=(null===(r=e.source)||void 0===r?void 0:r.toString())===(null==o?void 0:o.toString())&&(null===(a=e.id)||void 0===a?void 0:a.toString())===(null==u?void 0:u.toString());return(0,n.jsxs)("div",{onClick:()=>!l&&U(e),className:"flex items-start gap-3 px-2 py-3 rounded-lg transition-all select-none duration-200 relative\n                      ".concat(l?"bg-green-500/10 dark:bg-green-500/20 border-green-500/30 border":"hover:bg-gray-200/50 dark:hover:bg-white/10 hover:scale-[1.02] cursor-pointer").trim(),children:[(0,n.jsx)("div",{className:"flex-shrink-0 w-12 h-20 bg-gray-300 dark:bg-gray-600 rounded overflow-hidden",children:e.episodes&&e.episodes.length>0&&(0,n.jsx)("img",{src:(0,h.a8)(e.poster),alt:e.title,className:"w-full h-full object-cover",onError:e=>{e.target.style.display="none"}})}),(0,n.jsxs)("div",{className:"flex-1 min-w-0 flex flex-col justify-between h-20",children:[(0,n.jsxs)("div",{className:"flex items-start justify-between gap-3 h-6",children:[(0,n.jsxs)("div",{className:"flex-1 min-w-0 relative group/title",children:[(0,n.jsx)("h3",{className:"font-medium text-base truncate text-gray-900 dark:text-gray-100 leading-none",children:e.title}),0!==t&&(0,n.jsxs)("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-1 bg-gray-800 text-white text-xs rounded-md shadow-lg opacity-0 invisible group-hover/title:opacity-100 group-hover/title:visible transition-all duration-200 ease-out delay-100 whitespace-nowrap z-[500] pointer-events-none",children:[e.title,(0,n.jsx)("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800"})]})]}),(()=>{let t="".concat(e.source,"-").concat(e.id),r=y.get(t);if(r&&"未知"!==r.quality){if(r.hasError)return(0,n.jsx)("div",{className:"bg-gray-500/10 dark:bg-gray-400/20 text-red-600 dark:text-red-400 px-1.5 py-0 rounded text-xs flex-shrink-0 min-w-[50px] text-center",children:"检测失败"});{let e=["4K","2K"].includes(r.quality),t=["1080p","720p"].includes(r.quality);return(0,n.jsx)("div",{className:"bg-gray-500/10 dark:bg-gray-400/20 ".concat(e?"text-purple-600 dark:text-purple-400":t?"text-green-600 dark:text-green-400":"text-yellow-600 dark:text-yellow-400"," px-1.5 py-0 rounded text-xs flex-shrink-0 min-w-[50px] text-center"),children:r.quality})}}return null})()]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("span",{className:"text-xs px-2 py-1 border border-gray-500/60 rounded text-gray-700 dark:text-gray-300",children:e.source_name}),e.episodes.length>1&&(0,n.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 font-medium",children:[e.episodes.length," 集"]})]}),(0,n.jsx)("div",{className:"flex items-end h-6",children:(()=>{let t="".concat(e.source,"-").concat(e.id),r=y.get(t);if(r)return r.hasError?(0,n.jsx)("div",{className:"text-red-500/90 dark:text-red-400 font-medium text-xs",children:"无测速数据"}):(0,n.jsxs)("div",{className:"flex items-end gap-3 text-xs",children:[(0,n.jsx)("div",{className:"text-green-600 dark:text-green-400 font-medium text-xs",children:r.loadSpeed}),(0,n.jsxs)("div",{className:"text-orange-600 dark:text-orange-400 font-medium text-xs",children:[r.pingTime,"ms"]})]})})()})]})]},"".concat(e.source,"-").concat(e.id))}),(0,n.jsx)("div",{className:"flex-shrink-0 mt-auto pt-2 border-t border-gray-400 dark:border-gray-700",children:(0,n.jsx)("button",{onClick:()=>{d&&p.push("/search?q=".concat(encodeURIComponent(d)))},className:"w-full text-center text-xs text-gray-500 dark:text-gray-400 hover:text-green-500 dark:hover:text-green-400 transition-colors py-2",children:"影片匹配有误？点击去搜索"})})]})]})]})},g=r(93326),x=r(91202);function p(){var e;let t=(0,i.useRouter)(),r=(0,i.useSearchParams)(),[a,o]=(0,c.useState)(!0),[p,y]=(0,c.useState)("searching"),[b,w]=(0,c.useState)("正在搜索播放源..."),[j,k]=(0,c.useState)(null),[N,S]=(0,c.useState)(null),[M,D]=(0,c.useState)(!1),[E,C]=(0,c.useState)({enable:!1,intro_time:0,outro_time:0}),R=(0,c.useRef)(E);(0,c.useEffect)(()=>{R.current=E},[E,E.enable,E.intro_time,E.outro_time]);let _=(0,c.useRef)(0),[L,T]=(0,c.useState)(()=>{{let e=localStorage.getItem("enable_blockad");if(null!==e)return"true"===e}return!0}),P=(0,c.useRef)(L);(0,c.useEffect)(()=>{P.current=L},[L]);let[I,A]=(0,c.useState)(r.get("title")||""),[B,Z]=(0,c.useState)(r.get("year")||""),[O,U]=(0,c.useState)(""),[z,F]=(0,c.useState)(r.get("source")||""),[W,G]=(0,c.useState)(r.get("id")||""),[V]=(0,c.useState)(r.get("stitle")||""),[Y]=(0,c.useState)(r.get("stype")||""),[K,q]=(0,c.useState)("true"===r.get("prefer")),H=(0,c.useRef)(K);(0,c.useEffect)(()=>{H.current=K},[K]);let[J,X]=(0,c.useState)(0),Q=(0,c.useRef)(z),$=(0,c.useRef)(W),ee=(0,c.useRef)(I),et=(0,c.useRef)(B),er=(0,c.useRef)(N),en=(0,c.useRef)(J);(0,c.useEffect)(()=>{Q.current=z,$.current=W,er.current=N,en.current=J,ee.current=I,et.current=B},[z,W,N,J,I,B]);let[ea,el]=(0,c.useState)(""),es=(null==N?void 0:null===(e=N.episodes)||void 0===e?void 0:e.length)||0,eo=(0,c.useRef)(null),ei=(0,c.useRef)(.7),ec=(0,c.useRef)(1),[eu,ed]=(0,c.useState)([]),[em,eh]=(0,c.useState)(!1),[ef,eg]=(0,c.useState)(null),[ex]=(0,c.useState)(()=>{{let e=localStorage.getItem("enableOptimization");if(null!==e)try{return JSON.parse(e)}catch(e){}}return!0}),[ep,ev]=(0,c.useState)(new Map),[ey,eb]=(0,c.useState)(!1),[ew,ej]=(0,c.useState)(!0),[ek,eN]=(0,c.useState)("initing"),eS=(0,c.useRef)(null),eM=(0,c.useRef)(0),eD=(0,c.useRef)(null),eE=(0,c.useRef)(null),eC=async e=>{if(1===e.length)return e[0];let t=Math.ceil(e.length/2),r=[];for(let n=0;n<e.length;n+=t){let a=e.slice(n,n+t),l=await Promise.all(a.map(async e=>{try{if(!e.episodes||0===e.episodes.length)return console.warn("播放源 ".concat(e.source_name," 没有可用的播放地址")),null;let t=e.episodes.length>1?e.episodes[1]:e.episodes[0],r=await (0,h.e9)(t);return{source:e,testResult:r}}catch(e){return null}}));r.push(...l)}let n=new Map;r.forEach((t,r)=>{let a=e[r],l="".concat(a.source,"-").concat(a.id);t&&n.set(l,t.testResult)});let a=r.filter(Boolean);if(ev(n),0===a.length)return console.warn("所有播放源测速都失败，使用第一个播放源"),e[0];let l=a.map(e=>{let t=e.testResult.loadSpeed;if("未知"===t||"测量中..."===t)return 0;let r=t.match(/^([\d.]+)\s*(KB\/s|MB\/s)$/);if(!r)return 0;let n=parseFloat(r[1]);return"MB/s"===r[2]?1024*n:n}).filter(e=>e>0),s=l.length>0?Math.max(...l):1024,o=a.map(e=>e.testResult.pingTime).filter(e=>e>0),i=o.length>0?Math.min(...o):50,c=o.length>0?Math.max(...o):1e3,u=a.map(e=>({...e,score:eR(e.testResult,s,i,c)}));return u.sort((e,t)=>t.score-e.score),console.log("播放源评分排序结果:"),u.forEach((e,t)=>{console.log("".concat(t+1,". ").concat(e.source.source_name," - 评分: ").concat(e.score.toFixed(2)," (").concat(e.testResult.quality,", ").concat(e.testResult.loadSpeed,", ").concat(e.testResult.pingTime,"ms)"))}),u[0].source},eR=(e,t,r,n)=>{let a;return Math.round(100*(0+.4*(()=>{switch(e.quality){case"4K":return 100;case"2K":return 85;case"1080p":return 75;case"720p":return 60;case"480p":return 40;case"SD":return 20;default:return 0}})()+.4*(()=>{let r=e.loadSpeed;if("未知"===r||"测量中..."===r)return 30;let n=r.match(/^([\d.]+)\s*(KB\/s|MB\/s)$/);if(!n)return 30;let a=parseFloat(n[1]);return Math.min(100,Math.max(0,("MB/s"===n[2]?1024*a:a)/t*100))})()+.2*(()=>{let t=e.pingTime;return t<=0?0:n===r?100:Math.min(100,Math.max(0,(n-t)/(n-r)*100))})()))/100},e_=(e,t)=>{if(!e||!e.episodes||t>=e.episodes.length){el("");return}let r=(null==e?void 0:e.episodes[t])||"";r!==ea&&el(r)},eL=(e,t)=>{if(!e||!t)return;let r=Array.from(e.getElementsByTagName("source"));if(!r.some(e=>e.src===t)){r.forEach(e=>e.remove());let n=document.createElement("source");n.src=t,e.appendChild(n)}e.disableRemotePlayback=!1,e.hasAttribute("disableRemotePlayback")&&e.removeAttribute("disableRemotePlayback")},eT=async e=>{if(Q.current&&$.current)try{C(e),e.enable||e.intro_time||e.outro_time?await (0,u.C2)(Q.current,$.current,e):(await (0,u.Lj)(Q.current,$.current),eD.current.setting.update({name:"跳过片头片尾",html:"跳过片头片尾",switch:R.current.enable,onSwitch:function(e){let t={...R.current,enable:!e.switch};return eT(t),!e.switch}}),eD.current.setting.update({name:"设置片头",html:"设置片头",icon:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="5" cy="12" r="2" fill="#ffffff"/><path d="M9 12L17 12" stroke="#ffffff" stroke-width="2"/><path d="M17 6L17 18" stroke="#ffffff" stroke-width="2"/></svg>',tooltip:0===R.current.intro_time?"设置片头时间":"".concat(eP(R.current.intro_time)),onClick:function(){var e;let t=(null===(e=eD.current)||void 0===e?void 0:e.currentTime)||0;if(t>0){let e={...R.current,intro_time:t};return eT(e),"".concat(eP(t))}}}),eD.current.setting.update({name:"设置片尾",html:"设置片尾",icon:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7 6L7 18" stroke="#ffffff" stroke-width="2"/><path d="M7 12L15 12" stroke="#ffffff" stroke-width="2"/><circle cx="19" cy="12" r="2" fill="#ffffff"/></svg>',tooltip:R.current.outro_time>=0?"设置片尾时间":"-".concat(eP(-R.current.outro_time)),onClick:function(){var e,t;let r=-((null===(e=eD.current)||void 0===e?void 0:e.duration)-(null===(t=eD.current)||void 0===t?void 0:t.currentTime))||0;if(r<0){let e={...R.current,outro_time:r};return eT(e),"-".concat(eP(-r))}}})),console.log("跳过片头片尾配置已保存:",e)}catch(e){console.error("保存跳过片头片尾配置失败:",e)}},eP=e=>{if(0===e)return"00:00";let t=Math.floor(e/3600),r=Math.floor(e%3600/60),n=Math.round(e%60);return 0===t?"".concat(r.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0")):"".concat(t.toString().padStart(2,"0"),":").concat(r.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0"))};class eI extends s.ZP.DefaultConfig.loader{constructor(e){super(e);let t=this.load.bind(this);this.load=function(e,r,n){if("manifest"===e.type||"level"===e.type){let e=n.onSuccess;n.onSuccess=function(t,r,n){return t.data&&"string"==typeof t.data&&(t.data=function(e){if(!e)return"";let t=e.split("\n"),r=[];for(let e=0;e<t.length;e++){let n=t[e];n.includes("#EXT-X-DISCONTINUITY")||r.push(n)}return r.join("\n")}(t.data)),e(t,r,n,null)}}t(e,r,n)}}}(0,c.useEffect)(()=>{e_(N,J)},[N,J]),(0,c.useEffect)(()=>{let e=async(e,t)=>{try{let r=(await (0,d.ll)()).find(t=>t.key===e);if(!r)throw Error("无效源");let n=await (0,m.J)(r,t);return ed([n]),[n]}catch(e){return console.error("获取视频详情失败:",e),[]}finally{eh(!1)}},t=async e=>{try{let t=(await (0,d.ll)()).map(t=>(0,m.s)(t,e.trim()).catch(()=>[])),r=(await Promise.all(t)).flat().filter(e=>e.title.replaceAll(" ","").toLowerCase()===ee.current.replaceAll(" ","").toLowerCase()&&(!et.current||e.year.toLowerCase()===et.current.toLowerCase())&&(!Y||"tv"===Y&&e.episodes.length>1||"movie"===Y&&1===e.episodes.length));return ed(r),r}catch(e){return eg(e instanceof Error?e.message:"搜索失败"),ed([]),[]}finally{eh(!1)}};(async()=>{if(!z&&!W&&!I&&!V){k("缺少必要参数"),o(!1);return}o(!0),y(z&&W?"fetching":"searching"),w(z&&W?"\uD83C\uDFAC 正在获取视频详情...":"\uD83D\uDD0D 正在搜索播放源...");let r=await t(V||I);if(z&&W&&!r.some(e=>e.source===z&&e.id===W)&&(r=await e(z,W)),0===r.length){k("未找到匹配结果"),o(!1);return}let n=r[0];if(z&&W&&!H.current){let e=r.find(e=>e.source===z&&e.id===W);if(e)n=e;else{k("未找到匹配结果"),o(!1);return}}(!z||!W||H.current)&&ex&&(y("preferring"),w("⚡ 正在优选最佳播放源..."),n=await eC(r)),console.log(n.source,n.id),q(!1),F(n.source),G(n.id),Z(n.year),A(n.title||ee.current),U(n.poster),S(n),J>=n.episodes.length&&X(0);let a=new URL(window.location.href);a.searchParams.set("source",n.source),a.searchParams.set("id",n.id),a.searchParams.set("year",n.year),a.searchParams.set("title",n.title),a.searchParams.delete("prefer"),window.history.replaceState({},"",a.toString()),y("ready"),w("✨ 准备就绪，即将开始播放..."),setTimeout(()=>{o(!1)},1e3)})()},[]),(0,c.useEffect)(()=>{(async()=>{if(z&&W)try{let e=(await (0,u.Rr)())[(0,u.sO)(z,W)];if(e){let t=e.index-1,r=e.play_time;t!==J&&X(t),eo.current=r}}catch(e){console.error("读取播放记录失败:",e)}})()},[]),(0,c.useEffect)(()=>{(async()=>{if(z&&W)try{let e=await (0,u.bP)(z,W);e&&C(e)}catch(e){console.error("读取跳过片头片尾配置失败:",e)}})()},[]);let eA=async(e,t,r)=>{try{var n;eN("sourceChanging"),ej(!0);let a=(null===(n=eD.current)||void 0===n?void 0:n.currentTime)||0;if(console.log("换源前当前播放时间:",a),Q.current&&$.current)try{await (0,u.Ji)(Q.current,$.current),console.log("已清除前一个播放记录")}catch(e){console.error("清除播放记录失败:",e)}if(Q.current&&$.current)try{await (0,u.Lj)(Q.current,$.current),await (0,u.C2)(e,t,R.current)}catch(e){console.error("清除跳过片头片尾配置失败:",e)}let l=eu.find(r=>r.source===e&&r.id===t);if(!l){k("未找到匹配结果");return}let s=J;(!l.episodes||s>=l.episodes.length)&&(s=0),s!==J?eo.current=0:(!eo.current||0===eo.current)&&a>1&&(eo.current=a);let o=new URL(window.location.href);o.searchParams.set("source",e),o.searchParams.set("id",t),o.searchParams.set("year",l.year),window.history.replaceState({},"",o.toString()),A(l.title||r),Z(l.year),U(l.poster),F(e),G(t),S(l),X(s)}catch(e){ej(!1),k(e instanceof Error?e.message:"换源失败")}};(0,c.useEffect)(()=>(document.addEventListener("keydown",eO),()=>{document.removeEventListener("keydown",eO)}),[]);let eB=()=>{let e=er.current,t=en.current;e&&e.episodes&&t>0&&(eD.current&&!eD.current.paused&&eU(),X(t-1))},eZ=()=>{let e=er.current,t=en.current;e&&e.episodes&&t<e.episodes.length-1&&(eD.current&&!eD.current.paused&&eU(),X(t+1))},eO=e=>{if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName){if(e.altKey&&"ArrowLeft"===e.key&&er.current&&en.current>0&&(eB(),e.preventDefault()),e.altKey&&"ArrowRight"===e.key){let t=er.current,r=en.current;t&&r<t.episodes.length-1&&(eZ(),e.preventDefault())}!e.altKey&&"ArrowLeft"===e.key&&eD.current&&eD.current.currentTime>5&&(eD.current.currentTime-=10,e.preventDefault()),!e.altKey&&"ArrowRight"===e.key&&eD.current&&eD.current.currentTime<eD.current.duration-5&&(eD.current.currentTime+=10,e.preventDefault()),"ArrowUp"===e.key&&eD.current&&eD.current.volume<1&&(eD.current.volume=Math.round((eD.current.volume+.1)*10)/10,eD.current.notice.show="音量: ".concat(Math.round(100*eD.current.volume)),e.preventDefault()),"ArrowDown"===e.key&&eD.current&&eD.current.volume>0&&(eD.current.volume=Math.round((eD.current.volume-.1)*10)/10,eD.current.notice.show="音量: ".concat(Math.round(100*eD.current.volume)),e.preventDefault())," "===e.key&&eD.current&&(eD.current.toggle(),e.preventDefault()),("f"===e.key||"F"===e.key)&&eD.current&&(eD.current.fullscreen=!eD.current.fullscreen,e.preventDefault())}},eU=async()=>{var e,t,r,n,a,l;if(!eD.current||!Q.current||!$.current||!ee.current||!(null===(e=er.current)||void 0===e?void 0:e.source_name))return;let s=eD.current,o=s.currentTime||0,i=s.duration||0;if(!(o<1)&&i)try{await (0,u.c1)(Q.current,$.current,{title:ee.current,source_name:(null===(t=er.current)||void 0===t?void 0:t.source_name)||"",year:null===(r=er.current)||void 0===r?void 0:r.year,cover:(null===(n=er.current)||void 0===n?void 0:n.poster)||"",index:en.current+1,total_episodes:(null===(a=er.current)||void 0===a?void 0:a.episodes.length)||1,play_time:Math.floor(o),total_time:Math.floor(i),save_time:Date.now(),search_title:V}),eM.current=Date.now(),console.log("播放进度已保存:",{title:ee.current,episode:en.current+1,year:null===(l=er.current)||void 0===l?void 0:l.year,progress:"".concat(Math.floor(o),"/").concat(Math.floor(i))})}catch(e){console.error("保存播放进度失败:",e)}};(0,c.useEffect)(()=>{let e=()=>{eU()},t=()=>{"hidden"===document.visibilityState&&eU()};return window.addEventListener("beforeunload",e),document.addEventListener("visibilitychange",t),()=>{window.removeEventListener("beforeunload",e),document.removeEventListener("visibilitychange",t)}},[J,N,eD.current]),(0,c.useEffect)(()=>()=>{eS.current&&clearInterval(eS.current)},[]),(0,c.useEffect)(()=>{z&&W&&(async()=>{try{let e=await (0,u.at)(z,W);D(e)}catch(e){console.error("检查收藏状态失败:",e)}})()},[z,W]),(0,c.useEffect)(()=>{if(z&&W)return(0,u.rq)("favoritesUpdated",e=>{D(!!e[(0,u.sO)(z,W)])})},[z,W]);let ez=async()=>{if(ee.current&&er.current&&Q.current&&$.current)try{if(M)await (0,u.r7)(Q.current,$.current),D(!1);else{var e,t,r,n;await (0,u.qn)(Q.current,$.current,{title:ee.current,source_name:(null===(e=er.current)||void 0===e?void 0:e.source_name)||"",year:null===(t=er.current)||void 0===t?void 0:t.year,cover:(null===(r=er.current)||void 0===r?void 0:r.poster)||"",total_episodes:(null===(n=er.current)||void 0===n?void 0:n.episodes.length)||1,save_time:Date.now(),search_title:V}),D(!0)}}catch(e){console.error("切换收藏失败:",e)}};return((0,c.useEffect)(()=>{var e,t;if(!l()||!s.ZP||!ea||a||null===J||!eE.current)return;if(!N||!N.episodes||J>=N.episodes.length||J<0){k("选集索引无效，当前共 ".concat(es," 集"));return}if(!ea){k("视频地址无效");return}console.log(ea);let r="function"==typeof window.webkitConvertPointFromNodeToPage;if(!r&&eD.current){eD.current.switch=ea,eD.current.title="".concat(I," - 第").concat(J+1,"集"),eD.current.poster=O,(null===(e=eD.current)||void 0===e?void 0:e.video)&&eL(eD.current.video,ea);return}eD.current&&(eD.current.video&&eD.current.video.hls&&eD.current.video.hls.destroy(),eD.current.destroy(),eD.current=null);try{l().PLAYBACK_RATE=[.5,.75,1,1.25,1.5,2,3],l().USE_RAF=!0,eD.current=new(l())({container:eE.current,url:ea,poster:O,volume:.7,isLive:!1,muted:!1,autoplay:!0,pip:!0,autoSize:!1,autoMini:!1,screenshot:!1,setting:!0,loop:!1,flip:!1,playbackRate:!0,aspectRatio:!1,fullscreen:!0,fullscreenWeb:!0,subtitleOffset:!1,miniProgressBar:!1,mutex:!0,playsInline:!0,autoPlayback:!1,airplay:!0,theme:"#22c55e",lang:"zh-cn",hotkey:!1,fastForward:!0,autoOrientation:!0,lock:!0,moreVideoAttr:{crossOrigin:"anonymous"},customType:{m3u8:function(e,t){if(!s.ZP){console.error("HLS.js 未加载");return}e.hls&&e.hls.destroy();let r=new s.ZP({debug:!1,enableWorker:!0,lowLatencyMode:!0,maxBufferLength:30,backBufferLength:30,maxBufferSize:6e7,loader:P.current?eI:s.ZP.DefaultConfig.loader});r.loadSource(t),r.attachMedia(e),e.hls=r,eL(e,t),r.on(s.ZP.Events.ERROR,function(e,t){if(console.error("HLS Error:",e,t),t.fatal)switch(t.type){case s.ZP.ErrorTypes.NETWORK_ERROR:console.log("网络错误，尝试恢复..."),r.startLoad();break;case s.ZP.ErrorTypes.MEDIA_ERROR:console.log("媒体错误，尝试恢复..."),r.recoverMediaError();break;default:console.log("无法恢复的错误"),r.destroy()}})}},icons:{loading:'<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MCIgaGVpZ2h0PSI1MCIgdmlld0JveD0iMCAwIDUwIDUwIj48cGF0aCBkPSJNMjUuMjUxIDYuNDYxYy0xMC4zMTggMC0xOC42ODMgOC4zNjUtMTguNjgzIDE4LjY4M2g0LjA2OGMwLTguMDcgNi41NDUtMTQuNjE1IDE0LjYxNS0xNC42MTVWNi40NjF6IiBmaWxsPSIjMDA5Njg4Ij48YW5pbWF0ZVRyYW5zZm9ybSBhdHRyaWJ1dGVOYW1lPSJ0cmFuc2Zvcm0iIGF0dHJpYnV0ZVR5cGU9IlhNTCIgZHVyPSIxcyIgZnJvbT0iMCAyNSAyNSIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiIHRvPSIzNjAgMjUgMjUiIHR5cGU9InJvdGF0ZSIvPjwvcGF0aD48L3N2Zz4=">'},settings:[{html:"去广告",icon:'<text x="50%" y="50%" font-size="20" font-weight="bold" text-anchor="middle" dominant-baseline="middle" fill="#ffffff">AD</text>',tooltip:L?"已开启":"已关闭",onClick(){let e=!L;try{localStorage.setItem("enable_blockad",String(e)),eD.current&&(eo.current=eD.current.currentTime,eD.current.video&&eD.current.video.hls&&eD.current.video.hls.destroy(),eD.current.destroy(),eD.current=null),T(e)}catch(e){}return e?"当前开启":"当前关闭"}},{name:"跳过片头片尾",html:"跳过片头片尾",switch:R.current.enable,onSwitch:function(e){let t={...R.current,enable:!e.switch};return eT(t),!e.switch}},{html:"删除跳过配置",onClick:function(){return eT({enable:!1,intro_time:0,outro_time:0}),""}},{name:"设置片头",html:"设置片头",icon:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="5" cy="12" r="2" fill="#ffffff"/><path d="M9 12L17 12" stroke="#ffffff" stroke-width="2"/><path d="M17 6L17 18" stroke="#ffffff" stroke-width="2"/></svg>',tooltip:0===R.current.intro_time?"设置片头时间":"".concat(eP(R.current.intro_time)),onClick:function(){var e;let t=(null===(e=eD.current)||void 0===e?void 0:e.currentTime)||0;if(t>0){let e={...R.current,intro_time:t};return eT(e),"".concat(eP(t))}}},{name:"设置片尾",html:"设置片尾",icon:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7 6L7 18" stroke="#ffffff" stroke-width="2"/><path d="M7 12L15 12" stroke="#ffffff" stroke-width="2"/><circle cx="19" cy="12" r="2" fill="#ffffff"/></svg>',tooltip:R.current.outro_time>=0?"设置片尾时间":"-".concat(eP(-R.current.outro_time)),onClick:function(){var e,t;let r=-((null===(e=eD.current)||void 0===e?void 0:e.duration)-(null===(t=eD.current)||void 0===t?void 0:t.currentTime))||0;if(r<0){let e={...R.current,outro_time:r};return eT(e),"-".concat(eP(-r))}}}],controls:[{position:"left",index:13,html:'<i class="art-icon flex"><svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z" fill="currentColor"/></svg></i>',tooltip:"播放下一集",click:function(){eZ()}}]}),eD.current.on("ready",()=>{k(null)}),eD.current.on("video:volumechange",()=>{ei.current=eD.current.volume}),eD.current.on("video:ratechange",()=>{ec.current=eD.current.playbackRate}),eD.current.on("video:canplay",()=>{if(eo.current&&eo.current>0)try{let e=eD.current.duration||0,t=eo.current;e&&t>=e-2&&(t=Math.max(0,e-5)),eD.current.currentTime=t,console.log("成功恢复播放进度到:",eo.current)}catch(e){console.warn("恢复播放进度失败:",e)}eo.current=null,setTimeout(()=>{Math.abs(eD.current.volume-ei.current)>.01&&(eD.current.volume=ei.current),Math.abs(eD.current.playbackRate-ec.current)>.01&&r&&(eD.current.playbackRate=ec.current),eD.current.notice.show=""},0),ej(!1)}),eD.current.on("video:timeupdate",()=>{if(!R.current.enable)return;let e=eD.current.currentTime||0,t=eD.current.duration||0,r=Date.now();if(!(r-_.current<1500)&&(_.current=r,R.current.intro_time>0&&e<R.current.intro_time&&(eD.current.currentTime=R.current.intro_time,eD.current.notice.show="已跳过片头 (".concat(eP(R.current.intro_time),")")),R.current.outro_time<0&&t>0&&e>eD.current.duration+R.current.outro_time)){var n,a;en.current<((null===(a=er.current)||void 0===a?void 0:null===(n=a.episodes)||void 0===n?void 0:n.length)||1)-1?eZ():eD.current.pause(),eD.current.notice.show="已跳过片尾 (".concat(eP(R.current.outro_time),")")}}),eD.current.on("error",e=>{if(console.error("播放器错误:",e),eD.current.currentTime>0)return}),eD.current.on("video:ended",()=>{let e=er.current,t=en.current;e&&e.episodes&&t<e.episodes.length-1&&setTimeout(()=>{X(t+1)},1e3)}),eD.current.on("video:timeupdate",()=>{let e=Date.now(),t=5e3;"d1"===x.env.NEXT_PUBLIC_STORAGE_TYPE&&(t=1e4),"upstash"===x.env.NEXT_PUBLIC_STORAGE_TYPE&&(t=2e4),e-eM.current>t&&(eU(),eM.current=e)}),eD.current.on("pause",()=>{eU()}),(null===(t=eD.current)||void 0===t?void 0:t.video)&&eL(eD.current.video,ea)}catch(e){console.error("创建播放器失败:",e),k("播放器初始化失败")}},[l(),s.ZP,ea,a,L]),(0,c.useEffect)(()=>()=>{eS.current&&clearInterval(eS.current)},[]),a)?(0,n.jsx)(g.Z,{activePath:"/play",children:(0,n.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-transparent",children:(0,n.jsxs)("div",{className:"text-center max-w-md mx-auto px-6",children:[(0,n.jsxs)("div",{className:"relative mb-8",children:[(0,n.jsxs)("div",{className:"relative mx-auto w-24 h-24 bg-gradient-to-r from-green-500 to-emerald-600 rounded-2xl shadow-2xl flex items-center justify-center transform hover:scale-105 transition-transform duration-300",children:[(0,n.jsxs)("div",{className:"text-white text-4xl",children:["searching"===p&&"\uD83D\uDD0D","preferring"===p&&"⚡","fetching"===p&&"\uD83C\uDFAC","ready"===p&&"✨"]}),(0,n.jsx)("div",{className:"absolute -inset-2 bg-gradient-to-r from-green-500 to-emerald-600 rounded-2xl opacity-20 animate-spin"})]}),(0,n.jsxs)("div",{className:"absolute top-0 left-0 w-full h-full pointer-events-none",children:[(0,n.jsx)("div",{className:"absolute top-2 left-2 w-2 h-2 bg-green-400 rounded-full animate-bounce"}),(0,n.jsx)("div",{className:"absolute top-4 right-4 w-1.5 h-1.5 bg-emerald-400 rounded-full animate-bounce",style:{animationDelay:"0.5s"}}),(0,n.jsx)("div",{className:"absolute bottom-3 left-6 w-1 h-1 bg-lime-400 rounded-full animate-bounce",style:{animationDelay:"1s"}})]})]}),(0,n.jsxs)("div",{className:"mb-6 w-80 mx-auto",children:[(0,n.jsxs)("div",{className:"flex justify-center space-x-2 mb-4",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded-full transition-all duration-500 ".concat("searching"===p||"fetching"===p?"bg-green-500 scale-125":"preferring"===p||"ready"===p?"bg-green-500":"bg-gray-300")}),(0,n.jsx)("div",{className:"w-3 h-3 rounded-full transition-all duration-500 ".concat("preferring"===p?"bg-green-500 scale-125":"ready"===p?"bg-green-500":"bg-gray-300")}),(0,n.jsx)("div",{className:"w-3 h-3 rounded-full transition-all duration-500 ".concat("ready"===p?"bg-green-500 scale-125":"bg-gray-300")})]}),(0,n.jsx)("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 overflow-hidden",children:(0,n.jsx)("div",{className:"h-full bg-gradient-to-r from-green-500 to-emerald-600 rounded-full transition-all duration-1000 ease-out",style:{width:"searching"===p||"fetching"===p?"33%":"preferring"===p?"66%":"100%"}})})]}),(0,n.jsx)("div",{className:"space-y-2",children:(0,n.jsx)("p",{className:"text-xl font-semibold text-gray-800 dark:text-gray-200 animate-pulse",children:b})})]})})}):j?(0,n.jsx)(g.Z,{activePath:"/play",children:(0,n.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-transparent",children:(0,n.jsxs)("div",{className:"text-center max-w-md mx-auto px-6",children:[(0,n.jsxs)("div",{className:"relative mb-8",children:[(0,n.jsxs)("div",{className:"relative mx-auto w-24 h-24 bg-gradient-to-r from-red-500 to-orange-500 rounded-2xl shadow-2xl flex items-center justify-center transform hover:scale-105 transition-transform duration-300",children:[(0,n.jsx)("div",{className:"text-white text-4xl",children:"\uD83D\uDE35"}),(0,n.jsx)("div",{className:"absolute -inset-2 bg-gradient-to-r from-red-500 to-orange-500 rounded-2xl opacity-20 animate-pulse"})]}),(0,n.jsxs)("div",{className:"absolute top-0 left-0 w-full h-full pointer-events-none",children:[(0,n.jsx)("div",{className:"absolute top-2 left-2 w-2 h-2 bg-red-400 rounded-full animate-bounce"}),(0,n.jsx)("div",{className:"absolute top-4 right-4 w-1.5 h-1.5 bg-orange-400 rounded-full animate-bounce",style:{animationDelay:"0.5s"}}),(0,n.jsx)("div",{className:"absolute bottom-3 left-6 w-1 h-1 bg-yellow-400 rounded-full animate-bounce",style:{animationDelay:"1s"}})]})]}),(0,n.jsxs)("div",{className:"space-y-4 mb-8",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-200",children:"哎呀，出现了一些问题"}),(0,n.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:(0,n.jsx)("p",{className:"text-red-600 dark:text-red-400 font-medium",children:j})}),(0,n.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"请检查网络连接或尝试刷新页面"})]}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("button",{onClick:()=>I?t.push("/search?q=".concat(encodeURIComponent(I))):t.back(),className:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl font-medium hover:from-green-600 hover:to-emerald-700 transform hover:scale-105 transition-all duration-200 shadow-lg hover:shadow-xl",children:I?"\uD83D\uDD0D 返回搜索":"← 返回上页"}),(0,n.jsx)("button",{onClick:()=>window.location.reload(),className:"w-full px-6 py-3 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl font-medium hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200",children:"\uD83D\uDD04 重新尝试"})]})]})})}):(0,n.jsx)(g.Z,{activePath:"/play",children:(0,n.jsxs)("div",{className:"flex flex-col gap-3 py-4 px-5 lg:px-[3rem] 2xl:px-20",children:[(0,n.jsx)("div",{className:"py-1",children:(0,n.jsxs)("h1",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:[I||"影片标题",es>1&&(0,n.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:" > 第 ".concat(J+1," 集")})]})}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("div",{className:"hidden lg:flex justify-end",children:(0,n.jsxs)("button",{onClick:()=>eb(!ey),className:"group relative flex items-center space-x-1.5 px-3 py-1.5 rounded-full bg-white/80 hover:bg-white dark:bg-gray-800/80 dark:hover:bg-gray-800 backdrop-blur-sm border border-gray-200/50 dark:border-gray-700/50 shadow-sm hover:shadow-md transition-all duration-200",title:ey?"显示选集面板":"隐藏选集面板",children:[(0,n.jsx)("svg",{className:"w-3.5 h-3.5 text-gray-500 dark:text-gray-400 transition-transform duration-200 ".concat(ey?"rotate-180":"rotate-0"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})}),(0,n.jsx)("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-300",children:ey?"显示":"隐藏"}),(0,n.jsx)("div",{className:"absolute -top-0.5 -right-0.5 w-2 h-2 rounded-full transition-all duration-200 ".concat(ey?"bg-orange-400 animate-pulse":"bg-green-400")})]})}),(0,n.jsxs)("div",{className:"grid gap-4 lg:h-[500px] xl:h-[650px] 2xl:h-[750px] transition-all duration-300 ease-in-out ".concat(ey?"grid-cols-1":"grid-cols-1 md:grid-cols-4"),children:[(0,n.jsx)("div",{className:"h-full transition-all duration-300 ease-in-out rounded-xl border border-white/0 dark:border-white/30 ".concat(ey?"col-span-1":"md:col-span-3"),children:(0,n.jsxs)("div",{className:"relative w-full h-[300px] lg:h-full",children:[(0,n.jsx)("div",{ref:eE,className:"bg-black w-full h-full rounded-xl overflow-hidden shadow-lg"}),ew&&(0,n.jsx)("div",{className:"absolute inset-0 bg-black/85 backdrop-blur-sm rounded-xl flex items-center justify-center z-[500] transition-all duration-300",children:(0,n.jsxs)("div",{className:"text-center max-w-md mx-auto px-6",children:[(0,n.jsxs)("div",{className:"relative mb-8",children:[(0,n.jsxs)("div",{className:"relative mx-auto w-24 h-24 bg-gradient-to-r from-green-500 to-emerald-600 rounded-2xl shadow-2xl flex items-center justify-center transform hover:scale-105 transition-transform duration-300",children:[(0,n.jsx)("div",{className:"text-white text-4xl",children:"\uD83C\uDFAC"}),(0,n.jsx)("div",{className:"absolute -inset-2 bg-gradient-to-r from-green-500 to-emerald-600 rounded-2xl opacity-20 animate-spin"})]}),(0,n.jsxs)("div",{className:"absolute top-0 left-0 w-full h-full pointer-events-none",children:[(0,n.jsx)("div",{className:"absolute top-2 left-2 w-2 h-2 bg-green-400 rounded-full animate-bounce"}),(0,n.jsx)("div",{className:"absolute top-4 right-4 w-1.5 h-1.5 bg-emerald-400 rounded-full animate-bounce",style:{animationDelay:"0.5s"}}),(0,n.jsx)("div",{className:"absolute bottom-3 left-6 w-1 h-1 bg-lime-400 rounded-full animate-bounce",style:{animationDelay:"1s"}})]})]}),(0,n.jsx)("div",{className:"space-y-2",children:(0,n.jsx)("p",{className:"text-xl font-semibold text-white animate-pulse",children:"sourceChanging"===ek?"\uD83D\uDD04 切换播放源...":"\uD83D\uDD04 视频加载中..."})})]})})]})}),(0,n.jsx)("div",{className:"h-[300px] lg:h-full md:overflow-hidden transition-all duration-300 ease-in-out ".concat(ey?"md:col-span-1 lg:hidden lg:opacity-0 lg:scale-95":"md:col-span-1 lg:opacity-100 lg:scale-100"),children:(0,n.jsx)(f,{totalEpisodes:es,value:J+1,onChange:e=>{e>=0&&e<es&&(eD.current&&eD.current.paused&&eU(),X(e))},onSourceChange:eA,currentSource:z,currentId:W,videoTitle:V||I,availableSources:eu,sourceSearchLoading:em,sourceSearchError:ef,precomputedVideoInfo:ep})})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,n.jsx)("div",{className:"md:col-span-3",children:(0,n.jsxs)("div",{className:"p-6 flex flex-col min-h-0",children:[(0,n.jsxs)("h1",{className:"text-3xl font-bold mb-2 tracking-wide flex items-center flex-shrink-0 text-center md:text-left w-full",children:[I||"影片标题",(0,n.jsx)("button",{onClick:e=>{e.stopPropagation(),ez()},className:"ml-3 flex-shrink-0 hover:opacity-80 transition-opacity",children:(0,n.jsx)(v,{filled:M})})]}),(0,n.jsxs)("div",{className:"flex flex-wrap items-center gap-3 text-base mb-4 opacity-80 flex-shrink-0",children:[(null==N?void 0:N.class)&&(0,n.jsx)("span",{className:"text-green-600 font-semibold",children:N.class}),((null==N?void 0:N.year)||B)&&(0,n.jsx)("span",{children:(null==N?void 0:N.year)||B}),(null==N?void 0:N.source_name)&&(0,n.jsx)("span",{className:"border border-gray-500/60 px-2 py-[1px] rounded",children:N.source_name}),(null==N?void 0:N.type_name)&&(0,n.jsx)("span",{children:N.type_name})]}),(null==N?void 0:N.desc)&&(0,n.jsx)("div",{className:"mt-0 text-base leading-relaxed opacity-90 overflow-y-auto pr-2 flex-1 min-h-0 scrollbar-hide",style:{whiteSpace:"pre-line"},children:N.desc})]})}),(0,n.jsx)("div",{className:"hidden md:block md:col-span-1 md:order-first",children:(0,n.jsx)("div",{className:"pl-0 py-4 pr-6",children:(0,n.jsx)("div",{className:"bg-gray-300 dark:bg-gray-700 aspect-[2/3] flex items-center justify-center rounded-xl overflow-hidden",children:O?(0,n.jsx)("img",{src:(0,h.a8)(O),alt:I,className:"w-full h-full object-cover"}):(0,n.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"封面图片"})})})})]})]})})}let v=e=>{let{filled:t}=e;return t?(0,n.jsx)("svg",{className:"h-7 w-7",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z",fill:"#ef4444",stroke:"#ef4444",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}):(0,n.jsx)(o.Z,{className:"h-7 w-7 stroke-[1] text-gray-600 dark:text-gray-300"})};function y(){return(0,n.jsx)(c.Suspense,{fallback:(0,n.jsx)("div",{children:"Loading..."}),children:(0,n.jsx)(p,{})})}}},function(e){e.O(0,[447,461,967,376,558,326,682,890,541,29,744],function(){return e(e.s=55764)}),_N_E=e.O()}]);