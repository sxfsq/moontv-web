"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[459],{92172:function(e,t,o){o.d(t,{Z:function(){return a}});var r=o(85787);let a=e=>{let{aspectRatio:t}=e;return(0,r.jsx)("div",{className:"w-full ".concat(t," rounded-lg"),style:{background:"linear-gradient(90deg, var(--skeleton-color) 25%, var(--skeleton-highlight) 50%, var(--skeleton-color) 75%)",backgroundSize:"200% 100%",animation:"shine 1.5s infinite"},children:(0,r.jsx)("style",{children:"\n      @keyframes shine {\n        0% { background-position: -200% 0; }\n        100% { background-position: 200% 0; }\n      }\n      \n      /* 亮色模式变量 */\n      :root {\n        --skeleton-color: #f0f0f0;\n        --skeleton-highlight: #e0e0e0;\n      }\n      \n      /* 暗色模式变量 */\n      @media (prefers-color-scheme: dark) {\n        :root {\n          --skeleton-color: #2d2d2d;\n          --skeleton-highlight: #3d3d3d;\n        }\n      }\n      \n      .dark {\n        --skeleton-color: #2d2d2d;\n        --skeleton-highlight: #3d3d3d;\n      }\n    "})})}},78070:function(e,t,o){o.d(t,{Z:function(){return v}});var r=o(85787),a=o(41647),n=o(90541),s=o(85639),i=o(87790),l=o(5304),c=o(8838),d=o(36429),u=o(56182),h=o(2551),p=o(92172);function v(e){var t,o,v,g,m,f,w,b;let{id:y,title:x="",query:k="",poster:j="",episodes:N,source:C,source_name:E,progress:_=0,year:P,from:S,currentEpisode:R,douban_id:D,onDelete:q,rate:H,items:L,type:Z=""}=e,F=(0,c.useRouter)(),[T,z]=(0,d.useState)(!1),[I,B]=(0,d.useState)(!1),U="search"===S&&!!(null==L?void 0:L.length),M=(0,d.useMemo)(()=>{if(!U||!L)return null;let e=new Map,t=new Map;L.forEach(o=>{var r;o.douban_id&&0!==o.douban_id&&e.set(o.douban_id,(e.get(o.douban_id)||0)+1);let a=(null===(r=o.episodes)||void 0===r?void 0:r.length)||0;a>0&&t.set(a,(t.get(a)||0)+1)});let o=e=>{let t,o=0;return e.forEach((e,r)=>{e>o&&(o=e,t=r)}),t};return{first:L[0],mostFrequentDoubanId:o(e),mostFrequentEpisodes:o(t)||0}},[U,L]),W=null!==(o=null==M?void 0:M.first.title)&&void 0!==o?o:x,A=null!==(v=null==M?void 0:M.first.poster)&&void 0!==v?v:j,J=null!==(g=null==M?void 0:M.first.source)&&void 0!==g?g:C,O=null!==(m=null==M?void 0:M.first.id)&&void 0!==m?m:y,$=String(null!==(f=null==M?void 0:M.mostFrequentDoubanId)&&void 0!==f?f:D),G=null!==(w=null==M?void 0:M.mostFrequentEpisodes)&&void 0!==w?w:N,K=null!==(b=null==M?void 0:M.first.year)&&void 0!==b?b:P,Q=k||"",V=U?(null==M?void 0:null===(t=M.first.episodes)||void 0===t?void 0:t.length)===1?"movie":"tv":Z;(0,d.useEffect)(()=>{if("douban"===S||!J||!O)return;(async()=>{try{let e=await (0,u.at)(J,O);z(e)}catch(e){throw Error("检查收藏状态失败")}})();let e=(0,u.sO)(J,O);return(0,u.rq)("favoritesUpdated",t=>{z(!!t[e])})},[S,J,O]);let X=(0,d.useCallback)(async e=>{if(e.preventDefault(),e.stopPropagation(),"douban"!==S&&J&&O)try{T?(await (0,u.r7)(J,O),z(!1)):(await (0,u.qn)(J,O,{title:W,source_name:E||"",year:K||"",cover:A,total_episodes:null!=G?G:1,save_time:Date.now()}),z(!0))}catch(e){throw Error("切换收藏状态失败")}},[S,J,O,W,E,K,A,G,T]),Y=(0,d.useCallback)(async e=>{if(e.preventDefault(),e.stopPropagation(),"playrecord"===S&&J&&O)try{await (0,u.Ji)(J,O),null==q||q()}catch(e){throw Error("删除播放记录失败")}},[S,J,O,q]),ee=(0,d.useCallback)(()=>{"douban"===S?F.push("/play?title=".concat(encodeURIComponent(W.trim())).concat(K?"&year=".concat(K):"").concat(V?"&stype=".concat(V):"")):J&&O&&F.push("/play?source=".concat(J,"&id=").concat(O,"&title=").concat(encodeURIComponent(W)).concat(K?"&year=".concat(K):"").concat(U?"&prefer=true":"").concat(Q?"&stitle=".concat(encodeURIComponent(Q.trim())):"").concat(V?"&stype=".concat(V):""))},[S,J,O,F,W,K,U,Q,V]),et=(0,d.useMemo)(()=>{let e={playrecord:{showSourceName:!0,showProgress:!0,showPlayButton:!0,showHeart:!0,showCheckCircle:!0,showDoubanLink:!1,showRating:!1},favorite:{showSourceName:!0,showProgress:!1,showPlayButton:!0,showHeart:!0,showCheckCircle:!1,showDoubanLink:!1,showRating:!1},search:{showSourceName:!0,showProgress:!1,showPlayButton:!0,showHeart:!U,showCheckCircle:!1,showDoubanLink:!!$,showRating:!1},douban:{showSourceName:!1,showProgress:!1,showPlayButton:!0,showHeart:!1,showCheckCircle:!1,showDoubanLink:!0,showRating:!!H}};return e[S]||e.search},[S,U,$,H]);return(0,r.jsxs)("div",{className:"group relative w-full rounded-lg bg-transparent cursor-pointer transition-all duration-300 ease-in-out hover:scale-[1.05] hover:z-[500]",onClick:ee,children:[(0,r.jsxs)("div",{className:"relative aspect-[2/3] overflow-hidden rounded-lg",children:[!I&&(0,r.jsx)(p.Z,{aspectRatio:"aspect-[2/3]"}),(0,r.jsx)(l.default,{src:(0,h.a8)(A),alt:W,fill:!0,className:"object-cover",referrerPolicy:"no-referrer",onLoadingComplete:()=>B(!0)}),(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent opacity-0 transition-opacity duration-300 ease-in-out group-hover:opacity-100"}),et.showPlayButton&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 transition-all duration-300 ease-in-out delay-75 group-hover:opacity-100 group-hover:scale-100",children:(0,r.jsx)(a.Z,{size:50,strokeWidth:.8,className:"text-white fill-transparent transition-all duration-300 ease-out hover:fill-green-500 hover:scale-[1.1]"})}),(et.showHeart||et.showCheckCircle)&&(0,r.jsxs)("div",{className:"absolute bottom-3 right-3 flex gap-3 opacity-0 translate-y-2 transition-all duration-300 ease-in-out group-hover:opacity-100 group-hover:translate-y-0",children:[et.showCheckCircle&&(0,r.jsx)(n.Z,{onClick:Y,size:20,className:"text-white transition-all duration-300 ease-out hover:stroke-green-500 hover:scale-[1.1]"}),et.showHeart&&(0,r.jsx)(s.Z,{onClick:X,size:20,className:"transition-all duration-300 ease-out ".concat(T?"fill-red-600 stroke-red-600":"fill-transparent stroke-white hover:stroke-red-400"," hover:scale-[1.1]")})]}),et.showRating&&H&&(0,r.jsx)("div",{className:"absolute top-2 right-2 bg-pink-500 text-white text-xs font-bold w-7 h-7 rounded-full flex items-center justify-center shadow-md transition-all duration-300 ease-out group-hover:scale-110",children:H}),G&&G>1&&(0,r.jsx)("div",{className:"absolute top-2 right-2 bg-green-500 text-white text-xs font-semibold px-2 py-1 rounded-md shadow-md transition-all duration-300 ease-out group-hover:scale-110",children:R?"".concat(R,"/").concat(G):G}),et.showDoubanLink&&$&&(0,r.jsx)("a",{href:"https://movie.douban.com/subject/".concat($),target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"absolute top-2 left-2 opacity-0 -translate-x-2 transition-all duration-300 ease-in-out delay-100 group-hover:opacity-100 group-hover:translate-x-0",children:(0,r.jsx)("div",{className:"bg-green-500 text-white text-xs font-bold w-7 h-7 rounded-full flex items-center justify-center shadow-md hover:bg-green-600 hover:scale-[1.1] transition-all duration-300 ease-out",children:(0,r.jsx)(i.Z,{size:16})})})]}),et.showProgress&&void 0!==_&&(0,r.jsx)("div",{className:"mt-1 h-1 w-full bg-gray-200 rounded-full overflow-hidden",children:(0,r.jsx)("div",{className:"h-full bg-green-500 transition-all duration-500 ease-out",style:{width:"".concat(_,"%")}})}),(0,r.jsxs)("div",{className:"mt-2 text-center",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("span",{className:"block text-sm font-semibold truncate text-gray-900 dark:text-gray-100 transition-colors duration-300 ease-in-out group-hover:text-green-600 dark:group-hover:text-green-400 peer",children:W}),(0,r.jsxs)("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-1 bg-gray-800 text-white text-xs rounded-md shadow-lg opacity-0 invisible peer-hover:opacity-100 peer-hover:visible transition-all duration-200 ease-out delay-100 whitespace-nowrap pointer-events-none",children:[W,(0,r.jsx)("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800"})]})]}),et.showSourceName&&E&&(0,r.jsx)("span",{className:"block text-xs text-gray-500 dark:text-gray-400 mt-1",children:(0,r.jsx)("span",{className:"inline-block border rounded px-2 py-0.5 border-gray-500/60 dark:border-gray-400/60 transition-all duration-300 ease-in-out group-hover:border-green-500/60 group-hover:text-green-600 dark:group-hover:text-green-400",children:E})})]})]})}},50429:function(e,t,o){o.d(t,{$E:function(){return l},Z_:function(){return i}});var r=o(2551);let a=["https://cors.isteed.cc/","https://cors.isteed.cc/https://"];async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=new AbortController,n=setTimeout(()=>o.abort(),1e4),s=(0,r.NF)(),i=s?"".concat(s).concat(encodeURIComponent(e)):e,l={...t,signal:o.signal,headers:{Accept:"application/json, text/plain, */*",...t.headers}};try{let t=await fetch(i,l);if(clearTimeout(n),("opaque"===t.type||!t.ok)&&!s)for(let o of a)try{let r=await fetch(o.endsWith("https://")?"".concat(o).concat(e.replace(/^https?:\/\//,"")):"".concat(o).concat(e),l);if(r.ok&&"opaque"!==r.type){t=r;break}}catch(e){}return t}catch(t){if(clearTimeout(n),!s)for(let t of a)try{let o=await fetch(t.endsWith("https://")?"".concat(t).concat(e.replace(/^https?:\/\//,"")):"".concat(t).concat(e),l);if(o.ok&&"opaque"!==o.type)return o}catch(e){}throw t}}async function s(e){let{kind:t,category:o,type:r,pageLimit:a=20,pageStart:s=0}=e;if(!["tv","movie"].includes(t))throw Error("kind 参数必须是 tv 或 movie");if(!o||!r)throw Error("category 和 type 参数不能为空");if(a<1||a>100)throw Error("pageLimit 必须在 1-100 之间");if(s<0)throw Error("pageStart 不能小于 0");let i="https://m.douban.com/rexxar/api/v2/subject/recent_hot/".concat(t,"?start=").concat(s,"&limit=").concat(a,"&category=").concat(o,"&type=").concat(r);try{let e=await n(i);if(!e.ok)throw Error("HTTP error! Status: ".concat(e.status));let t=(await e.json()).items.map(e=>{var t,o,r,a,n;return{id:e.id,title:e.title,poster:(null===(t=e.pic)||void 0===t?void 0:t.normal)||(null===(o=e.pic)||void 0===o?void 0:o.large)||"",rate:(null===(r=e.rating)||void 0===r?void 0:r.value)?e.rating.value.toFixed(1):"",year:(null===(n=e.card_subtitle)||void 0===n?void 0:null===(a=n.match(/(\d{4})/))||void 0===a?void 0:a[1])||""}});return{code:200,message:"获取成功",list:t}}catch(e){throw window.dispatchEvent(new CustomEvent("globalError",{detail:{message:"获取豆瓣分类数据失败"}})),Error("获取豆瓣分类数据失败: ".concat(e.message))}}async function i(e){return s(e)}async function l(e){let{tag:t,type:o,pageLimit:r=20,pageStart:a=0}=e;return c(e)}async function c(e){let{tag:t,type:o,pageLimit:r=20,pageStart:a=0}=e;if(!t||!o)throw Error("tag 和 type 参数不能为空");if(!["tv","movie"].includes(o))throw Error("type 参数必须是 tv 或 movie");if(r<1||r>100)throw Error("pageLimit 必须在 1-100 之间");if(a<0)throw Error("pageStart 不能小于 0");let s="https://movie.douban.com/j/search_subjects?type=".concat(o,"&tag=").concat(t,"&sort=recommend&page_limit=").concat(r,"&page_start=").concat(a);try{let e=await n(s);if(!e.ok)throw Error("HTTP error! Status: ".concat(e.status));let t=(await e.json()).items.map(e=>{var t,o,r,a,n;return{id:e.id,title:e.title,poster:(null===(t=e.pic)||void 0===t?void 0:t.normal)||(null===(o=e.pic)||void 0===o?void 0:o.large)||"",rate:(null===(r=e.rating)||void 0===r?void 0:r.value)?e.rating.value.toFixed(1):"",year:(null===(n=e.card_subtitle)||void 0===n?void 0:null===(a=n.match(/(\d{4})/))||void 0===a?void 0:a[1])||""}});return{code:200,message:"获取成功",list:t}}catch(e){throw window.dispatchEvent(new CustomEvent("globalError",{detail:{message:"获取豆瓣列表数据失败"}})),Error("获取豆瓣分类数据失败: ".concat(e.message))}}}}]);